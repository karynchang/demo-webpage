!function() {
  "use strict";
  new Vue({
    el: "#app",
    data: {
      // gas部署後，複製 "網頁應用程式" 的網址
      gas: "https://script.google.com/macros/s/AKfycbwkMahdAnWP8kGqEZvT1pKsifiGEmwbTLKQsVKah7ssunVawV_4jzX-XP_5fvf7DYW7EA/exec",
      name: "",     // 清空name
      phone: "",    // 清空phone
      persons: {},  // 清空persons
      person: {
        join_type : "現場" 
      },   // 清空person

      // 報到單頁面點選F12，在元素頁籤中查詢 "<form"，action=後面的那串網址
      formAction: "https://docs.google.com/forms/u/0/d/e/1FAIpQLSfLFQnkyH0pjGjZbFV-dw_O1Z7oAJ9SDgd4lO34BVFLRwi7tA/formResponse",
      
      // 報到單頁面點選F12，在元素頁籤中查詢 "entry."，查詢每個欄位所對應的entry編號
      input: {
        id:'entry.1339314469',          // 報到單表單欄位：ID
        name: 'entry.2132758197',       // 報到單表單欄位：姓名
        gender: 'entry.1833440644',     // 報到單表單欄位：性別
        phone: 'entry.1937240046',      // 報到單表單欄位：電話
        area: 'entry.2050668982',       // 報到單表單欄位：地區
        district: 'entry.28899507',     // 報到單表單欄位：座談會地區
        org_1: 'entry.435100097',       // 報到單表單欄位：系統
        org_2: 'entry.1577594074',      // 報到單表單欄位：(準)支部/法座
        age: 'entry.152815214',         // 報到單表單欄位：年齡
        dept: 'entry.769254',           // 報到單表單欄位：學生部/青年部/一般/幼兒
        join_type: 'entry.1505873101',  // 報到單表單欄位：參加形式
        note: 'entry.1172474453',       // 報到單表單欄位：備註
        date: 'entry.1749391438'        // 報到單表單欄位：日期
      },
      loading: !1 //是否顯示loading
    },
    methods: {
      // 電話 最多 10 碼
      limitIdLen(val) {
        if(val.length > 10) {
        return this.phone =  this.phone.slice(0, 10);
        }
      },

      // 送出資料至 報到單 頁籤
      submit: function() {
        var t = this;
        
        console.log("join_type : ",t.person.join_type );
        if (void 0 !== this.person.area) {

          // 參加形式如未選擇，則預設回答為 現場
          if(void 0 === this.person.join_type){
            this.person.join_type = "現場";
          }

          var n = ""
            .concat(this.input.id, "=")
            .concat(this.person.id, "&")
            .concat(this.input.name, "=")
            .concat(this.person.name, "&")
            .concat(this.input.gender, "=")
            .concat(this.person.gender, "&")
            .concat(this.input.age, "=")
            .concat(this.person.age, "&")
            .concat(this.input.phone, "=")
            .concat(this.person.phone, "&")
            .concat(this.input.area, "=")
            .concat(this.person.area, "&")
            .concat(this.input.district, "=")
            .concat(this.person.district, "&")
            .concat(this.input.org_1, "=")
            .concat(this.person.org_1, "&")
            .concat(this.input.org_2, "=")
            .concat(this.person.org_2, "&")
            .concat(this.input.dept, "=")
            .concat(this.person.dept, "&")
            .concat(this.input.join_type, "=")
            .concat(this.person.join_type, "&")
            .concat(this.input.date, "=")
            .concat(this.person.date, "&")
            .concat(this.input.note, "=")
            .concat(this.person.note || "");
          // POST到報到單表單，填寫資料
          
          var currentTime = new Date();
          var formattedTime = currentTime.getFullYear()+"-"+(currentTime.getMonth() + 1).toString().padStart(2, '0')+"-"+currentTime.getDate().toString().padStart(2, '0')+" "+currentTime.getHours().toString().padStart(2, '0')+":"+currentTime.getMinutes().toString().padStart(2, '0')+":"+currentTime.getSeconds().toString().padStart(2, '0');
          var submitdata = this.person.name+ " 報到成功 \n時間：" + formattedTime + " \n \n請保留此畫面，作為入場憑證。";
          
          fetch(this.formAction + "?" + n, { method: "POST" }).catch(function(n) {
            alert(submitdata), t.name = "",t.phone="", t.person = {join_type : "現場" }, t.persons ={};
            nameGroup.style.display = 'block';
            joinGroup.style.display = 'block';
            comfirmNameButton.style.display = 'block';
            noteGroup.style.display = 'none';
            submitGroup.style.display = 'none';
            deptGroup.style.display = 'none'; 
            org_2_Group.style.display = 'none';
            org_1_Group.style.display = 'none';
            areaGroup.style.display = 'none';
            districtGroup.style.display = 'none';
            comfirmDataButton2.style.display = 'none';
            wrongDataButton2.style.display = 'none';
            comfirmDataButton.style.display = 'none';
            wrongDataButton.style.display = 'none';

          });
        }
      },
    
    confirmName: function() {
      var n = this;
      var phoneLength = phone.length;
      var deptName;
      
      // if(this.name.length >= 2 && this.name.length < 7 ){  // 2 <= 名字長度 <= 6
        if (void 0 === this.persons[this.name]) {
          this.loading = !0; // 是否顯示loading
          var i = this.gas + "?name=" + this.name + "&phone=" + this.phone;  // POS連結
          
          // POST到GAS查詢資料
          fetch(i, { method: "POST" })
            .then(function(t) {
              return t.json();
            })
            .then(function(t) {
              n.persons[n.name] = t, 
              n.person = t, 
              n.person.join_type = join,
              n.loading = !1; // 是否顯示loading
              console.log("join==",n.person.join_type)
              console.log("t.json()=",t);
              console.log("phoneLength=",phoneLength);



              if (phoneLength === 2 && void 0 === t.area) {
                // 使用 SweetAlert 彈出自定義訊息框
                Swal.fire({
                  title: '您尚未登錄過資料。',
                  text: '請點選確定填寫表單。',
                  icon: 'warning',
                  showCancelButton: true,
                  confirmButtonText: '確定',
                  cancelButtonText: '取消',
                  confirmButtonColor: "#142226",
                  cancelButtonColor: "#c0c2c3",
                  customClass: {
                    icon: 'my-swal-icon', // 使用自定義的 icon 類別
                    confirmButton: 'swal2-confirm'
                  }
                }).then((result) => {
                  if (result.isConfirmed) {
                    // 如果用戶點擊了確認按鈕，執行相應的操作
                    window.location.href = 'https://docs.google.com/forms/d/e/1FAIpQLScdilOxXRm3cScT8uk2z_t-KDH--Mqy3lD_ZQrf1Vng7faPdw/viewform';
                    n.name = "";
                    n.phone = "";
                    n.join_type = "" ;
                  } else {
                    // 如果用戶點擊了取消按鈕，執行其他操作或不做任何事情
                    n.name = "";
                    n.phone = "";
                    n.join_type = "" ;
                  }
                  
                });
              }
                 
                           
            });
            if (void 0 === deptName ) {
              deptGroup.style.display = 'block'; 
              org_2_Group.style.display = 'block';
              org_1_Group.style.display = 'block';
              areaGroup.style.display = 'block';
              districtGroup.style.display = 'block';
              comfirmDataButton.style.display = 'block';
              wrongDataButton.style.display = 'block';
              nameGroup.style.display = 'none';
              joinGroup.style.display = 'none';
              comfirmNameButton.style.display = 'none';
              console.log("join=",n.person.join_type)
              var join=n.person.join_type;
   
          } else {
              deptGroup.style.display = 'none';  
              org_2_Group.style.display = 'none';
              org_1_Group.style.display = 'none';
              areaGroup.style.display = 'none';
              districtGroup.style.display = 'none';
              comfirmDataButton.style.display = 'none';
              nameGroup.style.display = 'block';
              joinGroup.style.display = 'block';
              comfirmNameButton.style.display = 'block';
          }
          console.log("n.name=",n.name);
          console.log("person=",n.person);
          console.log("persons=",n.persons);
          n.person = {join_type : "現場" }, n.persons ={};
        } 
        else {
          this.person = this.persons[this.name]; 
          
        }
      // }  
    },
    confirmPhone: function(){
      var join = this.person.join_type;
      var phoneLength = phone.length;
    
        var i = this.gas + "?name=" + this.name + "&phone=" + this.phone; 
        var n = this;   
        fetch(i, { method: "POST" })
          .then(function(t) {
            return t.json();
          })
          .then(function(t) {
            n.persons[n.name] = t, 
              n.person = t, 
              n.loading = !1; // 是否顯示loading
              console.log("t.json()",t);
              console.log("phone.length",phoneLength);
              
              if(void 0 ===  t.area ) {
                // 使用 SweetAlert 彈出自定義訊息框
                Swal.fire({
                  title: '您尚未登錄過資料。',
                  text: '請點選確定填寫表單。',
                  icon: 'warning',
                  showCancelButton: true,
                  confirmButtonText: '確定',
                  cancelButtonText: '取消',
                  confirmButtonColor: "#142226",
                  cancelButtonColor: "#c0c2c3",
                  customClass: {
                    icon: 'my-swal-icon', // 使用自定義的 icon 類別
                    confirmButton: 'swal2-confirm'
                  }
                }).then((result) => {
                  if (result.isConfirmed) {
                    // 如果用戶點擊了確認按鈕，執行相應的操作
                    window.location.href = 'https://docs.google.com/forms/d/e/1FAIpQLScdilOxXRm3cScT8uk2z_t-KDH--Mqy3lD_ZQrf1Vng7faPdw/viewform';
                    n.name = "";
                    n.phone = "";
                    n.join_type = "" ;
                  } else {
                    // 如果用戶點擊了取消按鈕，執行其他操作或不做任何事情
                    n.name = "";
                    n.phone = "";
                    n.join_type = "" ;
                  }
                });
              }    n.person.join_type=join 

          });
        console.log("n.name=",n.name);
        console.log("person=",n.person);
        console.log("persons=",n.persons);
        console.log("phone=",n.person.phone);
        n.persons ={};
        console.log("join===",n.person.join_type)
        deptGroup.style.display = 'block'; 
        org_2_Group.style.display = 'block';
        org_1_Group.style.display = 'block';
        areaGroup.style.display = 'block';
        districtGroup.style.display = 'block';
        comfirmDataButton2.style.display = 'block';
        wrongDataButton2.style.display = 'block';
        phoneConfirmGroup.style.display = 'none';
        comfirmPhoneButton.style.display = 'none';
    },
    wrongData(){
      
      Swal.fire({
        title: '<div style="font-weight: bold;">請選擇資料不符原因',
        html: '<div style="text-align: left;">少部分資料不符合 <br>  → 請點選 修改資料。<br><br>資料全部不符合 <br>   → 請點選 改用電話查詢。',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: '修改資料',
        cancelButtonText: '改用電話查詢',
        confirmButtonColor: "#142226",
        cancelButtonColor: "#142226",
        customClass: {
          icon: 'my-swal-icon', // 使用自定義的 icon 類別
          confirmButton: 'swal2-confirm'
        }
      }).then((result) => {
        if (result.isConfirmed) {
          // 如果用戶點擊了確認按鈕，執行相應的操作
          console.log("點選修改")
          deptGroup.style.display = 'none';  
          org_2_Group.style.display = 'none';
          org_1_Group.style.display = 'none';
          areaGroup.style.display = 'none';
          districtGroup.style.display = 'none';
          comfirmDataButton.style.display = 'none';
          wrongDataButton.style.display = 'none';
          nameGroup.style.display = 'none';
          joinGroup.style.display = 'none';
          comfirmNameButton.style.display = 'none';
          noteGroup.style.display = 'block';
          submitGroup.style.display = 'block';
        } else {
          console.log("點選電話")
          deptGroup.style.display = 'none';  
          org_2_Group.style.display = 'none';
          org_1_Group.style.display = 'none';
          areaGroup.style.display = 'none';
          districtGroup.style.display = 'none';
          comfirmDataButton.style.display = 'none';
          wrongDataButton.style.display = 'none';
          nameGroup.style.display = 'none';
          joinGroup.style.display = 'none';
          comfirmNameButton.style.display = 'none';
          phoneConfirmGroup.style.display = 'block';
          comfirmPhoneButton.style.display = 'block';
          
        }
        
        
      });

    },
    wrongData2(){
      console.log("點選修改")
          deptGroup.style.display = 'none';  
          org_2_Group.style.display = 'none';
          org_1_Group.style.display = 'none';
          areaGroup.style.display = 'none';
          districtGroup.style.display = 'none';
          comfirmDataButton2.style.display = 'none';
          wrongDataButton2.style.display = 'none';
          nameGroup.style.display = 'none';
          joinGroup.style.display = 'none';
          comfirmNameButton.style.display = 'none';
          noteGroup.style.display = 'block';
          submitGroup.style.display = 'block';

    }
  }
  });
}();
